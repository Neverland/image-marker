!function(e){function t(e,t){if(!(this instanceof arguments.callee))return new arguments.callee(e,t);var n,o,a,i,l,c,r;o=document,a=this,c=im.tk,l=o.body,i=o.createDocumentFragment(),n=arguments.callee,e||(e={}),a.html=e.html,a.titleTxt=e.title||"标题",a.buttonText=e.btn||" 确定 ",a.hasMask=e.hasMask||!0,a.hasCancel=e.cancel||!0,a.cancelTxt=e.cancelTxt||" X ",a.width=e.width||400,a.height=e.height||300,a.hasAnimate=e.animate||!1,a.drag=e.drag||!1,a.name=e.name||"",a.maskColor=e.maskColor||"black",a.maskDepth=e.maskDepth||50,a.dialogBg=e.dialogBg||"white",a.zIndex=Math.floor(999+Math.random()*9e3),a.viewPort=c.getViewportSize(),a.scollPos=c.getScrollPosition(),a.maxSize=[a.viewPort[0]+a.scollPos[0],a.viewPort[1]+a.scollPos[1]],"function"==typeof t&&(a.fn=t),a.mask=a.title=a.titleCon=a.cancel=a.container=null,n.fn=n.prototype,n.fn.constructor=n,r=n.fn,r.init=function(){a.htmlFactory(),a.hasMask&&a.createMask(),a.createDailog(),a.addEvent()},r.htmlFactory=function(){a.mask=c.getHtmlElement("div"),a.dialog=c.getHtmlElement("div"),a.title=c.getHtmlElement("h3"),a.titleCon=c.getHtmlElement("span"),a.cancel=c.getHtmlElement("b"),a.container=c.getHtmlElement("div")},r.createMask=function(){l.appendChild(a.mask),a.mask.style.cssText="position:absolute;z-index:"+a.zIndex+";background-color:"+a.maskColor+";opacity:"+a.maskDepth/100+";width:100%;height:"+l.parentNode.scrollHeight+"px;top:0;left:0;"},r.createDailog=function(){a.titleCon.appendChild(o.createTextNode(a.titleTxt)),a.title.appendChild(a.titleCon),a.cancel.appendChild(o.createTextNode(a.cancelTxt)),a.cancel.style.cssText="position:absolute;cursor:pointer",a.title.appendChild(a.cancel),a.container.appendChild(a.title),a.name&&(a.container.id="dialogContainer-"+a.name),a.container.className="dialogContainer",a.dialog.appendChild(a.title),a.dialog.style.cssText="position:absolute;z-index:"+(a.zIndex+1)+";width:"+a.width+"px;height:"+a.height+"px;left:"+(a.viewPort[0]-a.width)/2+"px;top:"+((a.viewPort[1]-a.height)/2+a.scollPos[1])+"px;background-color:"+a.dialogBg,a.name&&(a.dialog.id="dialog-"+a.name),a.dialog.className="dialog",a.dialog.appendChild(a.container),a.hasAnimate&&(a.dialog.style.opacity=0,im.animate.fadeIn.call(a.dialog,80)),i.appendChild(a.dialog),l.appendChild(i),l.style.overflowY="hidden",a.html&&(a.container.innerHTML=a.html),a.fn&&a.fn.call(a)},r.removeDailog=function(){try{a.dialog.parentNode.removeChild(a.dialog)}catch(e){}try{a.mask.parentNode.removeChild(a.mask)}catch(e){}l.removeAttribute("style"),a.dialog=a.mask=null},r.addEvent=function(){c.addEvent(a.cancel,"click",function(){a.removeDailog()},!1),c.addEvent(a.title,"mousedown",function(e){a.drag&&a.mousemoveCheckThreshold(e,this.parentNode)},!1)},r.mousemoveCheckThreshold=function(e,t){e=c.getEvent(e);var n=c.getScrollPosition();t.nodeType&&t.nodeType===1&&(a.currentTarget=t,{mousedown:function(e){e=c.getEvent(e),c.stopEvent(e),a.currentTarget,a.pos=c.getClinetRect(a.currentTarget),a.origin=[e.clientX-a.pos.left,e.clientY-a.pos.top],o.onmousemove=function(e){a.mousemoveCheckThreshold(e,t)},o.onmouseup=function(e){a.mousemoveCheckThreshold(e,t)}},mousemove:function(e){e=c.getEvent(e),a.currentTarget;try{a.currentTarget.style.top=e.clientY-a.origin[1]+n[1]+"px",a.currentTarget.style.left=e.clientX-a.origin[0]+n[0]+"px"}catch(e){}c.stopEvent(e)},mouseup:function(e){e=c.getEvent(e),a.currentTarget,o.onmousemove=null,o.onmouseup=null,a.currentTarget=null,c.stopEvent(e)}}[e.type](e))},a.init()}im.tk.addEvent(e,"load",function(){im.module.dialog||(im.module.dialog=t)},!1)}(window);