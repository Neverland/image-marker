!function(e){function t(e,t){if(!(this instanceof arguments.callee))return new arguments.callee(e,t);var n,o,i,a,r,l,c;o=document,i=this,l=im.tk,r=o.body,a=o.createDocumentFragment(),n=arguments.callee,e||(e={}),i.html=e.html,i.titleTxt=e.title||"标题",i.buttonText=e.btn||" 确定 ",i.hasMask=e.hasMask||!0,i.hasCancel=e.cancel||!0,i.cancelTxt=e.cancelTxt||" X ",i.width=e.width||400,i.height=e.height||300,i.hasAnimate=e.animate||!1,i.drag=e.drag||!1,i.name=e.name||"",i.maskColor=e.maskColor||"black",i.maskDepth=e.maskDepth||50,i.dialogBg=e.dialogBg||"white",i.zIndex=Math.floor(999+Math.random()*9e3),i.viewPort=l.getViewportSize(),i.scollPos=l.getScrollPosition(),i.maxSize=[i.viewPort[0]+i.scollPos[0],i.viewPort[1]+i.scollPos[1]],"function"==typeof t&&(i.fn=t),i.mask=i.title=i.titleCon=i.cancel=i.container=null,n.fn=n.prototype,n.fn.constructor=n,c=n.fn,c.init=function(){i.htmlFactory(),i.hasMask&&i.createMask(),i.createDailog(),i.addEvent()},c.htmlFactory=function(){i.mask=l.getHtmlElement("div"),i.dialog=l.getHtmlElement("div"),i.title=l.getHtmlElement("h3"),i.titleCon=l.getHtmlElement("span"),i.cancel=l.getHtmlElement("b"),i.container=l.getHtmlElement("div")},c.createMask=function(){r.appendChild(i.mask),i.mask.style.cssText="position:absolute;z-index:"+i.zIndex+";background-color:"+i.maskColor+";opacity:"+i.maskDepth/100+";width:100%;height:"+r.parentNode.scrollHeight+"px;top:0;left:0;"},c.createDailog=function(){i.titleCon.appendChild(o.createTextNode(i.titleTxt)),i.title.appendChild(i.titleCon),i.cancel.appendChild(o.createTextNode(i.cancelTxt)),i.cancel.style.cssText="position:absolute;cursor:pointer",i.title.appendChild(i.cancel),i.container.appendChild(i.title),i.name&&(i.container.id="dialogContainer-"+i.name),i.container.className="dialogContainer",i.dialog.appendChild(i.title),i.dialog.style.cssText="position:absolute;z-index:"+(i.zIndex+1)+";width:"+i.width+"px;height:"+i.height+"px;left:"+(i.viewPort[0]-i.width)/2+"px;top:"+((i.viewPort[1]-i.height)/2+i.scollPos[1])+"px;background-color:"+i.dialogBg,i.name&&(i.dialog.id="dialog-"+i.name),i.dialog.className="dialog",i.dialog.appendChild(i.container),i.hasAnimate&&(i.dialog.style.opacity=0,im.animate.fadeIn.call(i.dialog,80)),a.appendChild(i.dialog),r.appendChild(a),r.style.overflowY="hidden",i.html&&(i.container.innerHTML=i.html),i.fn&&i.fn.call(i)},c.removeDailog=function(){try{i.dialog.parentNode.removeChild(i.dialog)}catch(e){}try{i.mask.parentNode.removeChild(i.mask)}catch(e){}r.removeAttribute("style"),i.dialog=i.mask=null},c.addEvent=function(){l.addEvent(i.cancel,"click",function(){i.removeDailog()},!1),l.addEvent(i.title,"mousedown",function(e){i.drag&&i.mousemoveCheckThreshold(e,this.parentNode)},!1)},c.mousemoveCheckThreshold=function(e,t){e=l.getEvent(e);var n=l.getScrollPosition();t.nodeType&&t.nodeType===1&&(i.currentTarget=t,{mousedown:function(e){e=l.getEvent(e),l.stopEvent(e),i.currentTarget,i.pos=l.getClinetRect(i.currentTarget),i.origin=[e.clientX-i.pos.left,e.clientY-i.pos.top],o.onmousemove=function(e){i.mousemoveCheckThreshold(e,t)},o.onmouseup=function(e){i.mousemoveCheckThreshold(e,t)}},mousemove:function(e){e=l.getEvent(e),i.currentTarget;try{i.currentTarget.style.top=e.clientY-i.origin[1]+n[1]+"px",i.currentTarget.style.left=e.clientX-i.origin[0]+n[0]+"px"}catch(e){}l.stopEvent(e)},mouseup:function(e){e=l.getEvent(e),i.currentTarget,o.onmousemove=null,o.onmouseup=null,i.currentTarget=null,l.stopEvent(e)}}[e.type](e))},i.init()}im.tk.addEvent(e,"load",function(){im.module.dialog||(im.module.dialog=t)},!1)}(window);